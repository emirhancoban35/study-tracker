<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#000000">
    <link rel="apple-touch-icon" href="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA1MTIgNTEyIj48cmVjdCB3aWR0aD0iNTEyIiBoZWlnaHQ9IjUxMiIgZmlsbD0iIzExMTExMSIvPjxyZWN0IHg9IjEyOCIgeT0iMTI4IiB3aWR0aD0iMjU2IiBoZWlnaHQ9IjI1NiIgZmlsbD0ibm9uZSIgc3Ryb2tlPSIjMDBlNjc2IiBzdHJva2Utd2lkdGg9IjMyIi8+PHBhdGggZD0iTTM1NiAxOTIgTDIzNiAzMjAgMTU2IDI0MCIgc3Ryb2tlPSIjMDBlNjc2IiBzdHJva2Utd2lkdGg9IjMyIiBmaWxsPSJub25lIiBzdHJva2UtbGluZWNhcD0icm91bmQiIHN0cm9rZS1saW5lam9pbj0icm91bmQiLz48L3N2Zz4=">
    <title>DGS LIFE OS v5.3</title>
    
    <style>
        /* üåå SYSTEM THEME: DEEP SPACE & NEON */
        :root {
            --bg-body: #050505;
            --bg-card: #111111;
            --bg-panel: #1a1a1a;
            --primary: #00e676; /* Math */
            --secondary: #2979ff; /* Turkish */
            --tertiary: #ff9100; /* Paragraf */
            --danger: #ff1744; /* Alert */
            --gold: #ffc400; /* Economy */
            --purple: #d500f9; /* AI */
            --text-main: #ffffff;
            --text-muted: #888888;
            --font: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            --radius: 16px;
            --shadow: 0 8px 30px rgba(0,0,0,0.5);
        }

        /* RESET & BASE */
        * { box-sizing: border-box; margin: 0; padding: 0; user-select: none; -webkit-tap-highlight-color: transparent; outline: none; }
        body { background: var(--bg-body); color: var(--text-main); font-family: var(--font); min-height: 100vh; overflow-x: hidden; padding-bottom: 90px; }
        .hidden { display: none !important; }
        .container { padding: 16px; max-width: 600px; margin: 0 auto; }
        .flex-row { display: flex; align-items: center; justify-content: space-between; gap: 10px; }
        .flex-col { display: flex; flex-direction: column; gap: 12px; }
        .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        .grid-3 { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 8px; }
        
        .card { background: var(--bg-card); border-radius: var(--radius); padding: 16px; border: 1px solid #222; box-shadow: var(--shadow); position: relative; overflow: hidden; }
        .card-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; }
        .card-title { font-weight: 700; font-size: 0.95rem; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.5px; display: flex; align-items: center; gap: 6px; }
        
        .hud { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 8px; margin-bottom: 16px; }
        .hud-item { background: var(--bg-panel); border-radius: 12px; padding: 10px; text-align: center; border-bottom: 2px solid transparent; }
        .hud-val { font-size: 1.1rem; font-weight: 900; display: block; }
        .hud-lbl { font-size: 0.65rem; color: var(--text-muted); text-transform: uppercase; margin-top: 2px; }
        
        .ai-msg { background: rgba(213, 0, 249, 0.1); border-left: 3px solid var(--purple); padding: 10px; font-size: 0.85rem; color: #e0e0e0; border-radius: 4px; line-height: 1.4; margin-bottom: 10px; }
        .goal-bar { height: 6px; background: #222; border-radius: 3px; overflow: hidden; margin-top: 5px; }
        .goal-fill { height: 100%; transition: width 0.5s ease; }
        
        .focus-ring { width: 200px; height: 200px; border-radius: 50%; border: 4px solid #222; margin: 20px auto; display: flex; flex-direction: column; justify-content: center; align-items: center; position: relative; transition: 0.3s; }
        .focus-ring.active { border-color: var(--primary); box-shadow: 0 0 40px rgba(0, 230, 118, 0.2); }
        .timer-val { font-size: 3.5rem; font-weight: 800; font-variant-numeric: tabular-nums; letter-spacing: -2px; }
        .timer-state { font-size: 0.8rem; letter-spacing: 2px; color: var(--primary); text-transform: uppercase; opacity: 0; }
        .focus-ring.active .timer-state { opacity: 1; animation: pulse 1.5s infinite; }
        
        .graph-container { height: 100px; width: 100%; position: relative; border-bottom: 1px solid #333; border-left: 1px solid #333; margin-top: 10px; }
        svg { width: 100%; height: 100%; overflow: visible; }
        polyline { fill: none; stroke-width: 2; vector-effect: non-scaling-stroke; }
        
        .nav-dock { position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); width: 95%; max-width: 420px; background: rgba(26,26,26,0.95); backdrop-filter: blur(12px); border-radius: 24px; display: flex; justify-content: space-between; padding: 10px 20px; box-shadow: 0 10px 40px rgba(0,0,0,0.5); z-index: 100; border: 1px solid rgba(255,255,255,0.1); }
        .nav-icon { font-size: 1.4rem; opacity: 0.5; transition: 0.2s; transform: scale(0.9); display: block; margin-bottom: 2px;}
        .nav-item { flex: 1; text-align: center; font-size: 0.6rem; color: #888; }
        .nav-item.active .nav-icon { opacity: 1; transform: scale(1.1); text-shadow: 0 0 10px rgba(255,255,255,0.3); color: var(--primary); }
        .nav-item.active { color: #fff; }
        
        button { border: none; cursor: pointer; font-family: var(--font); }
        .btn-main { background: var(--primary); color: #000; width: 100%; padding: 14px; border-radius: 12px; font-weight: 800; font-size: 1rem; text-transform: uppercase; letter-spacing: 1px; margin-top: 10px; }
        .btn-main.stop { background: var(--danger); color: #fff; }
        .btn-small { padding: 6px 12px; border-radius: 8px; font-size: 0.8rem; font-weight: bold; background: #333; color: #fff; }
        .input-dark { background: #000; border: 1px solid #333; color: #fff; padding: 10px; border-radius: 8px; width: 100%; font-size: 0.9rem; }
        
        .cal-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 4px; margin-top: 10px; }
        .cal-cell { aspect-ratio: 1; border-radius: 4px; font-size: 0.7rem; display: flex; align-items: center; justify-content: center; background: #1a1a1a; color: #555; position: relative; }
        .cal-cell.today { border: 1px solid #fff; }
        .cal-cell.hit { background: rgba(0, 230, 118, 0.2); color: var(--primary); }
        .cal-cell.miss { background: rgba(255, 23, 68, 0.1); color: var(--danger); }
        .cal-cell.freeze { background: rgba(41, 121, 255, 0.2); color: var(--secondary); }
        
        .topic-item { background: #161616; padding: 12px; border-radius: 12px; margin-bottom: 8px; border-left: 3px solid #333; transition: 0.2s; }
        .topic-item.done { border-left-color: var(--primary); opacity: 0.8; }
        .topic-item.in-progress { border-left-color: var(--gold); }
        .topic-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px; }
        .topic-name { font-size: 0.9rem; font-weight: 600; }
        .topic-controls { display: flex; gap: 5px; align-items: center; }
        .topic-input { width: 50px; background: #000; border: 1px solid #333; color: #fff; border-radius: 6px; padding: 4px; text-align: center; font-size: 0.8rem; }
        .topic-add-btn { background: #333; color: var(--primary); width: 28px; height: 28px; border-radius: 6px; display: flex; align-items: center; justify-content: center; font-weight: bold; }
        .topic-check-btn { width: 24px; height: 24px; border-radius: 50%; border: 2px solid #444; display: flex; align-items: center; justify-content: center; font-size: 0.7rem; margin-left: 5px; cursor: pointer; }
        .topic-item.done .topic-check-btn { background: var(--primary); border-color: var(--primary); color: #000; }

        .medal-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 10px; }
        .medal-card { background: #161616; padding: 15px; border-radius: 12px; text-align: center; border: 1px solid #222; opacity: 0.5; filter: grayscale(1); transition: 0.3s; }
        .medal-card.unlocked { opacity: 1; filter: grayscale(0); border-color: var(--gold); background: rgba(255, 193, 7, 0.05); }
        .medal-icon { font-size: 2rem; margin-bottom: 5px; display: block; }
        .medal-title { font-size: 0.8rem; font-weight: bold; color: #fff; }
        .medal-desc { font-size: 0.65rem; color: #888; margin-top: 2px; }

        .mission-item { background: #0a0a0a; border: 1px solid #222; padding: 10px; border-radius: 8px; margin-bottom: 8px; }
        .mission-head { display: flex; justify-content: space-between; font-size: 0.8rem; margin-bottom: 6px; }
        .mission-bar { height: 6px; background: #222; border-radius: 3px; overflow: hidden; }
        .mission-fill { height: 100%; background: var(--gold); transition: width 0.3s; }
        
        .modal { position: fixed; top:0; left:0; width:100%; height:100%; background: rgba(0,0,0,0.9); z-index: 2000; display: flex; flex-direction: column; justify-content: center; align-items: center; padding: 30px; text-align: center; backdrop-filter: blur(10px); }
        .modal.hidden { display: none; }
        .modal h1 { font-size: 2rem; color: var(--primary); margin-bottom: 20px; }
        .modal p { color: #ccc; margin-bottom: 30px; line-height: 1.5; }

        .setting-row { display: flex; justify-content: space-between; align-items: center; padding: 12px 0; border-bottom: 1px solid #222; }
        .setting-label { font-size: 0.9rem; }

        /* GOAL LIST STYLE */
        .goal-list-item { background: #161616; padding: 10px; border-radius: 8px; margin-bottom: 8px; display: flex; justify-content: space-between; align-items: center; border: 1px solid #333; }
        .goal-list-info { font-size: 0.85rem; color: #fff; }
        .goal-list-net { font-size: 0.75rem; color: var(--primary); font-weight: bold; }
        .goal-del-btn { color: var(--danger); background: none; border: none; font-size: 1.2rem; cursor: pointer; padding: 0 5px; }

        @keyframes pulse { 0% { opacity: 0.4; } 50% { opacity: 1; } 100% { opacity: 0.4; } }
        
        .toast { position: fixed; top: 20px; left: 50%; transform: translateX(-50%) translateY(-50px); background: #222; border: 1px solid #444; padding: 12px 24px; border-radius: 30px; display: flex; align-items: center; gap: 10px; opacity: 0; transition: 0.3s; z-index: 3000; pointer-events: none; }
        .toast.visible { transform: translateX(-50%) translateY(0); opacity: 1; }
    </style>
</head>
<body>

<div id="onboarding" class="modal hidden">
    <h1>Yeni Ba≈ülangƒ±√ß</h1>
    <p>Ge√ßmi≈ü geride kaldƒ±. Bug√ºn DGS i√ßin yeni bir sayfa a√ßƒ±yoruz. <br><br>Bu sistem senin disiplin motorun olacak.</p>
    <button class="btn-main" onclick="UI.closeOnboarding()">HAZIRIM üî•</button>
</div>

<div class="container">
    
    <div class="hud">
        <div class="hud-item" style="border-color: var(--danger)">
            <span class="hud-val" id="hud-streak">0</span>
            <span class="hud-lbl">üî• Zincir</span>
        </div>
        <div class="hud-item" style="border-color: var(--gold)">
            <span class="hud-val" id="hud-diamonds">0</span>
            <span class="hud-lbl">üíé Elmas</span>
        </div>
        <div class="hud-item" style="border-color: var(--primary)">
            <span class="hud-val" id="hud-xp">0</span>
            <span class="hud-lbl">üèÜ XP</span>
        </div>
    </div>

    <div id="view-dash" class="view">
        
        <div class="card" id="ai-card">
            <div class="card-header">
                <span class="card-title" style="color:var(--purple)">ü§ñ DGS AI Ko√ß</span>
                <span style="font-size:0.7rem; background:rgba(213,0,249,0.2); color:var(--purple); padding:2px 6px; border-radius:4px;">LIVE</span>
            </div>
            <div class="ai-msg" id="ai-message">Veriler analiz ediliyor...</div>
            
            <div style="display: flex; gap: 5px; margin-top: 10px;">
                <div style="flex:1; background:#000; padding:8px; border-radius:8px; text-align:center;">
                    <div style="font-size:0.7rem; color:#666;">MEVCUT NET</div>
                    <div style="font-weight:bold; color:var(--primary); font-size:1.1rem;" id="ai-score">0</div>
                </div>
                <div style="flex:1; background:#000; padding:8px; border-radius:8px; text-align:center;">
                    <div style="font-size:0.7rem; color:#666;">KALAN G√úN</div>
                    <div style="font-weight:bold; color:#fff; font-size:1.1rem;" id="ai-days">0</div>
                </div>
            </div>

            <div style="margin-top: 10px; background:#0a0a0a; padding:10px; border-radius:8px;">
                <div class="flex-row" style="margin-bottom: 5px;">
                    <span style="font-size:0.7rem; color:#aaa;">üéØ HEDEFLERƒ∞M</span>
                    <span style="font-size:0.8rem; font-weight:bold; color:#fff; cursor:pointer;" onclick="Nav.go('profile')">D√úZENLE ‚öôÔ∏è</span>
                </div>
                
                <div id="dynamic-goals-container">
                    <div style="text-align:center; padding:10px; font-size:0.8rem; color:#666;">
                        Hen√ºz hedef eklenmedi.<br>Profil sekmesinden ekle.
                    </div>
                </div>
            </div>

            <div id="smart-recommendation" style="margin-top:10px; padding-top:10px; border-top:1px solid #222;">
                <div style="font-size:0.75rem; color:var(--text-muted); text-transform:uppercase;">üöÄ Akƒ±llƒ± √ñneri</div>
                <div style="color:#fff; font-weight:bold; margin-top:2px;" id="rec-text">...</div>
            </div>
        </div>

        <div class="card" style="margin-top:12px;">
            <div class="card-header"><span class="card-title">üéñÔ∏è Haftalƒ±k G√∂revler</span></div>
            <div id="missions-list"></div>
        </div>

        <div class="card" style="text-align:center; margin-top:12px;">
            <div class="card-header"><span class="card-title">‚è±Ô∏è Odak Modu</span></div>
            <div class="focus-ring" id="focus-ui">
                <div class="timer-val" id="timer-disp">00:00</div>
                <div class="timer-state">ODAKLAN</div>
            </div>
            <button class="btn-main" id="btn-timer" onclick="App.toggleFocus()">BA≈ûLAT</button>
            <div style="margin-top:8px; font-size:0.7rem; color:#444;">Manuel giri≈ü yasaktƒ±r.</div>
        </div>

        <div class="card" style="margin-top:12px;">
            <div class="card-header">
                <span class="card-title">üìÖ G√ºnl√ºk Hedefler</span>
                <button onclick="App.tryFreeze()" style="background:none; color:var(--secondary); font-size:0.8rem;">‚ùÑÔ∏è Dondur</button>
            </div>
            
            <div class="flex-col">
                <div>
                    <div class="flex-row" style="font-size:0.8rem;">
                        <span>‚è±Ô∏è S√ºre</span>
                        <span id="prog-txt-time" style="color:var(--primary)">0/120 dk</span>
                    </div>
                    <div class="goal-bar"><div class="goal-fill" id="fill-time" style="width:0%; background:var(--primary)"></div></div>
                </div>
                <div>
                    <div class="flex-row" style="font-size:0.8rem;">
                        <span>‚úñÔ∏è Matematik</span>
                        <span id="prog-txt-mat" style="color:var(--primary)">0/50</span>
                    </div>
                    <div class="goal-bar"><div class="goal-fill" id="fill-mat" style="width:0%; background:var(--primary)"></div></div>
                    <div class="flex-row" style="margin-top:4px;">
                        <input type="number" id="inp-mat" class="input-dark" placeholder="Adet" style="padding:4px; font-size:0.8rem;">
                        <button onclick="App.addQ('mat')" style="background:#222; color:var(--primary); padding:4px 10px; border-radius:6px;">+</button>
                    </div>
                </div>
                <div>
                    <div class="flex-row" style="font-size:0.8rem;">
                        <span>üí¨ T√ºrk√ße (Dil Bilgisi)</span>
                        <span id="prog-txt-tr" style="color:var(--secondary)">0/30</span>
                    </div>
                    <div class="goal-bar"><div class="goal-fill" id="fill-tr" style="width:0%; background:var(--secondary)"></div></div>
                    <div class="flex-row" style="margin-top:4px;">
                        <input type="number" id="inp-tr" class="input-dark" placeholder="Adet" style="padding:4px; font-size:0.8rem;">
                        <button onclick="App.addQ('tr')" style="background:#222; color:var(--secondary); padding:4px 10px; border-radius:6px;">+</button>
                    </div>
                </div>
                <div>
                    <div class="flex-row" style="font-size:0.8rem;">
                        <span>üìë Paragraf</span>
                        <span id="prog-txt-par" style="color:var(--tertiary)">0/20</span>
                    </div>
                    <div class="goal-bar"><div class="goal-fill" id="fill-par" style="width:0%; background:var(--tertiary)"></div></div>
                    <div class="flex-row" style="margin-top:4px;">
                        <input type="number" id="inp-par" class="input-dark" placeholder="Adet" style="padding:4px; font-size:0.8rem;">
                        <button onclick="App.addQ('par')" style="background:#222; color:var(--tertiary); padding:4px 10px; border-radius:6px;">+</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="view-topics" class="view hidden">
        <div class="card">
            <div class="card-header">
                <span class="card-title">üìö Konu ƒ∞lerlemesi</span>
            </div>
            
            <div class="grid-3" style="margin-bottom:15px;">
                <div style="background:#000; padding:8px; border-radius:8px; border:1px solid #222; text-align:center;">
                    <div style="font-size:0.6rem; color:#888;">MATEMATƒ∞K</div>
                    <div style="font-size:1rem; font-weight:bold; color:var(--primary);" id="stat-mat-pct">0%</div>
                </div>
                <div style="background:#000; padding:8px; border-radius:8px; border:1px solid #222; text-align:center;">
                    <div style="font-size:0.6rem; color:#888;">T√úRK√áE</div>
                    <div style="font-size:1rem; font-weight:bold; color:var(--secondary);" id="stat-tr-pct">0%</div>
                </div>
                <div style="background:#000; padding:8px; border-radius:8px; border:1px solid #222; text-align:center;">
                    <div style="font-size:0.6rem; color:#888;">PARAGRAF</div>
                    <div style="font-size:1rem; font-weight:bold; color:var(--tertiary);" id="stat-par-pct">0%</div>
                </div>
            </div>

            <div style="margin-bottom:10px; display:flex; gap:5px;">
                <button class="btn-small" onclick="Topics.filter('mat')" style="flex:1;">Mat</button>
                <button class="btn-small" onclick="Topics.filter('tr')" style="flex:1;">Tr</button>
                <button class="btn-small" onclick="Topics.filter('par')" style="flex:1;">Par</button>
            </div>

            <div id="topics-list"></div>
        </div>
    </div>

    <div id="view-stats" class="view hidden">
        <div class="card">
            <div class="card-header"><span class="card-title">üìù Deneme Takibi</span></div>
            <div class="grid-2">
                <input type="number" id="exam-mat" class="input-dark" placeholder="Mat Net">
                <input type="number" id="exam-tr" class="input-dark" placeholder="Tr Net">
            </div>
            <button class="btn-main" style="background:var(--secondary); color:#fff; margin-top:8px; font-size:0.9rem;" onclick="App.addExam()">Deneme Kaydet</button>
            <div class="graph-container" id="net-graph"></div>
            <div class="flex-row" style="font-size:0.7rem; color:var(--text-muted); margin-top:5px;">
                <span>Son 5 Deneme Trendi</span>
                <span id="trend-val">--</span>
            </div>
        </div>

        <div class="card" style="margin-top:12px;">
            <div class="card-header"><span class="card-title">üìñ Kitap Okuma</span></div>
            <div class="flex-row">
                <input type="text" id="book-name" class="input-dark" placeholder="Kitap Adƒ±">
                <input type="number" id="book-pages" class="input-dark" placeholder="Sayfa" style="width:80px">
            </div>
            <button class="btn-main" style="background:var(--purple); color:#fff; margin-top:8px; font-size:0.9rem;" onclick="App.addBook()">Okuma Ekle (+XP)</button>
            <div id="book-list" class="flex-col" style="margin-top:10px; font-size:0.8rem; color:#aaa;"></div>
        </div>

        <div class="card" style="margin-top:12px;">
            <div class="card-header"><span class="card-title">üìÖ S√ºreklilik</span></div>
            <div style="font-size:0.7rem; color:#666; margin-bottom:5px;">Detay i√ßin g√ºne tƒ±kla.</div>
            <div class="cal-grid" id="cal-render"></div>
        </div>
    </div>

    <div id="view-medals" class="view hidden">
        <div class="card">
            <div class="card-header"><span class="card-title">üéñÔ∏è Ba≈üarƒ± Rozetleri</span></div>
            <div class="medal-grid" id="medal-container"></div>
        </div>
    </div>

    <div id="view-profile" class="view hidden">
        
        <div class="card" style="margin-bottom:12px;">
            <div class="card-header"><span class="card-title">üéØ Hedef Y√∂netimi</span></div>
            <div class="flex-col">
                <div class="flex-row">
                    <input type="text" id="new-goal-name" class="input-dark" placeholder="√ñrn: ODT√ú Bilgisayar">
                    <input type="number" id="new-goal-net" class="input-dark" placeholder="Net" style="width: 80px;">
                </div>
                <button class="btn-small" onclick="Goals.add()">+ Hedef Ekle</button>
            </div>
            <div id="goals-management-list" class="flex-col" style="margin-top:15px;">
                </div>
        </div>

        <div class="card">
            <div class="card-header"><span class="card-title">üë§ √ñƒürenci Profili</span></div>
            <div class="flex-col">
                <input type="text" id="prof-name" class="input-dark" placeholder="Adƒ±n" onchange="Profile.save()">
            </div>
        </div>

        <div class="card" style="margin-top:12px; border-color:var(--gold);">
            <div class="card-header"><span class="card-title" style="color:var(--gold);">‚òÅÔ∏è Bulut Senkronizasyon</span></div>
            <p style="font-size:0.75rem; color:#aaa; margin-bottom:10px;">Verilerini cihazlar arasƒ± ta≈üƒ±mak i√ßin kodu kopyala.</p>
            <div class="setting-row">
                <button class="btn-small" style="width:100%;" onclick="DataMgr.copySyncCode()">üì§ Veri Kodunu Kopyala</button>
            </div>
            <div class="flex-row" style="margin-top:10px;">
                <input type="text" id="sync-input" class="input-dark" placeholder="Veri kodunu buraya yapƒ±≈ütƒ±r...">
                <button class="btn-small" onclick="DataMgr.loadSyncCode()">üì• Y√ºkle</button>
            </div>
        </div>

        <div class="card" style="margin-top:12px;">
            <div class="card-header"><span class="card-title">‚öôÔ∏è Ayarlar</span></div>
            <div class="setting-row">
                <span class="setting-label">üîî Bildirimler</span>
                <button class="btn-small" onclick="Notify.req()">ƒ∞zin Ver</button>
            </div>
            <div class="setting-row" style="border-bottom:none;">
                <span class="setting-label" style="color:var(--danger)">‚ö†Ô∏è Sƒ±fƒ±rla</span>
                <button class="btn-small" style="background:var(--danger);" onclick="DataMgr.reset()">Reset</button>
            </div>
        </div>

        <div class="card" style="margin-top:12px;">
            <div class="card-header"><span class="card-title">üõí Market</span></div>
            <div class="grid-2">
                <div class="card" style="border:1px solid #333; padding:10px; text-align:center;">
                    <div style="font-size:2rem;">üõ°Ô∏è</div>
                    <div style="font-weight:bold; font-size:0.9rem;">Freeze</div>
                    <div style="color:var(--gold); font-size:0.8rem;">500 üíé</div>
                    <button onclick="Shop.buy('freeze')" style="width:100%; background:#222; color:#fff; padding:6px; margin-top:5px; border-radius:6px;">AL</button>
                </div>
                <div class="card" style="border:1px solid #333; padding:10px; text-align:center;">
                    <div style="font-size:2rem;">‚ö°</div>
                    <div style="font-weight:bold; font-size:0.9rem;">2x XP</div>
                    <div style="color:var(--gold); font-size:0.8rem;">300 üíé</div>
                    <button onclick="Shop.buy('boost')" style="width:100%; background:#222; color:#fff; padding:6px; margin-top:5px; border-radius:6px;">AL</button>
                </div>
            </div>
            <div style="margin-top:10px; font-size:0.8rem; color:#aaa; text-align:center;">
                üéí √áanta: <span id="inv-display">Bo≈ü</span>
            </div>
        </div>
    </div>

</div>

<div class="nav-dock">
    <div class="nav-item active" onclick="Nav.go('dash')"><span class="nav-icon">üè†</span>Ana</div>
    <div class="nav-item" onclick="Nav.go('topics')"><span class="nav-icon">üìö</span>Konu</div>
    <div class="nav-item" onclick="Nav.go('stats')"><span class="nav-icon">üìà</span>Analiz</div>
    <div class="nav-item" onclick="Nav.go('medals')"><span class="nav-icon">üéñÔ∏è</span>Rozet</div>
    <div class="nav-item" onclick="Nav.go('profile')"><span class="nav-icon">üë§</span>Profil</div>
</div>

<div class="toast" id="toast">
    <span id="t-icon">‚úÖ</span>
    <span id="t-msg">Mesaj</span>
</div>

<script>
/**
 * üß† DGS LIFE OS v5.3 (DYNAMIC GOALS)
 * Fixed Book Medals Logic + Multi-Target System
 */

var CONFIG = {
    examDate: "2026-06-30",
    dailyMin: { time: 60*60, mat: 30, tr: 20, par: 20 },
    xp: { min: 1, q: 2, topic: 50, page: 5, mission: 100 },
    storageKey: "DGS_OS_V5"
};

var DEFAULT_TOPICS = {
    mat: [
        "Temel Kavramlar", "Sayƒ± Basamaklarƒ±", "B√∂lme B√∂l√ºnebilme", "Rasyonel Sayƒ±lar", 
        "Basit E≈üitsizlikler", "Mutlak Deƒüer", "√úsl√º Sayƒ±lar", "K√∂kl√º Sayƒ±lar", 
        "√áarpanlara Ayƒ±rma", "Oran Orantƒ±", "Sayƒ± Problemleri", "Kesir Problemleri", 
        "Ya≈ü Problemleri", "Hareket Problemleri", "Y√ºzde Kar-Zarar", "K√ºmeler", 
        "Fonksiyonlar", "Perm√ºtasyon Kombinasyon", "Olasƒ±lƒ±k", "Sayƒ±sal Mantƒ±k"
    ],
    tr: [
        "S√∂zc√ºkte Anlam", "C√ºmlede Anlam", "Anlatƒ±m Bozukluƒüu", "S√∂zel Mantƒ±k"
    ],
    par: [
        "Paragrafƒ±n Anlamƒ±", "Paragrafƒ±n Yapƒ±sƒ±", "Paragrafta Ana D√º≈ü√ºnce", 
        "Paragrafta Yardƒ±mcƒ± D√º≈ü√ºnce", "Paragrafta Akƒ±≈ü Bozma"
    ]
};

// HELPER: Count Total Pages Read
function getTotalPages(d) {
    if(!d.books || d.books.length === 0) return 0;
    var sum = 0;
    d.books.forEach(function(b){ sum += (b.pages || 0); });
    return sum;
}

// 2Ô∏è‚É£ Badge Logic Fixed for PAGE COUNT
var MEDALS_DB = [
    { id: 'streak7', icon: 'üî•', title: 'Haftalƒ±k Ate≈ü', req: '7 G√ºn Zincir', check: function(d){ return d.user.streak >= 7; } },
    { id: 'streak30', icon: 'üëë', title: 'ƒ∞stikrar Kralƒ±', req: '30 G√ºn Zincir', check: function(d){ return d.user.streak >= 30; } },
    { id: 'streak60', icon: '‚ö°', title: '60 G√ºn Efsanesi', req: '60 G√ºn Zincir', check: function(d){ return d.user.streak >= 60; } },
    { id: 'q100', icon: 'üê£', title: 'Ba≈ülangƒ±√ß', req: '100 Soru √á√∂z', check: function(d){ return (d.stats?.totalQ || 0) >= 100; } },
    { id: 'q1000', icon: '‚úçÔ∏è', title: 'Soru Canavarƒ±', req: '1000 Soru √á√∂z', check: function(d){ return (d.stats?.totalQ || 0) >= 1000; } },
    { id: 'q5000', icon: 'üß†', title: 'Soru Makinesi', req: '5000 Soru √á√∂z', check: function(d){ return (d.stats?.totalQ || 0) >= 5000; } },
    { id: 'topic5', icon: 'üìö', title: 'Konu Ustasƒ±', req: '5 Konu Bitir', check: function(d){ return d.topics.filter(function(t){return t.status===2}).length >= 5; } },
    // BOOK MEDALS FIXED TO PAGES
    { id: 'bookworm1', icon: 'üêõ', title: 'Kitap Kurdu I', req: 'Top. 200 Sayfa Oku', check: function(d){ return getTotalPages(d) >= 200; } },
    { id: 'bookworm5', icon: 'üìñ', title: 'Kitap Kurdu II', req: 'Top. 1000 Sayfa Oku', check: function(d){ return getTotalPages(d) >= 1000; } },
    { id: 'exam1', icon: 'üìù', title: 'ƒ∞lk Deneme', req: '1 Deneme √á√∂z', check: function(d){ return d.exams.length >= 1; } },
    { id: 'exam10', icon: 'ü¶Å', title: 'Deneme Canavarƒ±', req: '10 Deneme √á√∂z', check: function(d){ return d.exams.length >= 10; } },
    { id: 'focus10h', icon: '‚è≥', title: 'Odak Tanrƒ±sƒ±', req: '10 Saat Odaklan', check: function(d){ return (d.stats?.totalTime || 0) >= 10 * 3600; } },
    { id: 'early_bird', icon: 'üåÖ', title: 'Erken Kalkan', req: '08:00\'den √∂nce ba≈üla', check: function(d){ return false; } },
    { id: 'night_owl', icon: 'ü¶â', title: 'Gece Ku≈üu', req: '22:00\'den sonra √ßalƒ±≈ü', check: function(d){ return false; } }
];

/* --- üíæ STATE MANAGER --- */
var State = {
    data: {
        user: { xp: 0, diamonds: 100, streak: 0, lastLog: null, name: '', goals: [] },
        inventory: { freeze: 0, boost: 0 },
        today: { date: null, time: 0, mat: 0, tr: 0, par: 0, frozen: false, completed: false },
        weekly: { start: 0, missions: [] },
        topics: [], 
        exams: [],
        books: [],
        stats: { totalQ: 0, totalTime: 0 },
        medals: [],
        history: {}
    },

    init: function() {
        var s = localStorage.getItem(CONFIG.storageKey);
        if(s) {
            try { 
                var parsed = JSON.parse(s);
                this.data = Object.assign({}, this.data, parsed);
                // Ensure goals array exists
                if(!this.data.user.goals) this.data.user.goals = [];
                if(typeof this.data.today.par === 'undefined') this.data.today.par = 0;
                var hasPar = this.data.topics.some(function(t){ return t.subject === 'par'; });
                if(!hasPar) this.seedTopics();
                if(!this.data.stats) this.data.stats = { totalQ: 0, totalTime: 0 };
                if(!this.data.weekly || !this.data.weekly.missions) this.resetWeekly();
            } catch(e){ console.error("Data Load Error", e); }
        } else {
            this.seedTopics();
            this.resetWeekly();
            document.getElementById('onboarding').classList.remove('hidden');
        }
        this.checkDay();
        Medals.check();
    },

    seedTopics: function() {
        var t = this.data.topics || [];
        var add = function(arr, subj) {
            arr.forEach(function(n){
                if(!t.find(function(ex){ return ex.name === n; })) {
                    t.push({subject:subj, name:n, status:0, q:0});
                }
            });
        };
        add(DEFAULT_TOPICS.mat, 'mat');
        add(DEFAULT_TOPICS.tr, 'tr');
        add(DEFAULT_TOPICS.par, 'par');
        this.data.topics = t;
    },

    resetWeekly: function() {
        this.data.weekly = {
            start: new Date().getTime(),
            missions: [
                { id: 1, text: "5 Saat √áalƒ±≈ü", target: 5*60*60, current: 0, type: 'time', claimed: false },
                { id: 2, text: "200 Soru √á√∂z", target: 200, current: 0, type: 'q', claimed: false },
                { id: 3, text: "1 Konu ƒ∞lerle", target: 1, current: 0, type: 'topic', claimed: false }
            ]
        };
    },

    save: function() {
        localStorage.setItem(CONFIG.storageKey, JSON.stringify(this.data));
        UI.render();
    },

    checkDay: function() {
        var now = new Date().toISOString().split('T')[0];
        var oneWeek = 7 * 24 * 60 * 60 * 1000;
        if(new Date().getTime() - this.data.weekly.start > oneWeek) this.resetWeekly();

        if(this.data.today.date !== now) {
            if(this.data.today.date) {
                var status = this.data.today.completed ? 'hit' : (this.data.today.frozen ? 'freeze' : 'miss');
                this.data.history[this.data.today.date] = {
                    status: status,
                    time: this.data.today.time,
                    q: this.data.today.mat + this.data.today.tr + (this.data.today.par || 0)
                };

                if(status === 'miss' && this.data.user.streak > 0) {
                    this.data.user.streak = 0;
                    Notify.send("üíî Zincir Kƒ±rƒ±ldƒ±", "D√ºn √ßalƒ±≈ümadƒ±n.");
                } else if (status === 'hit') {
                    var s = this.data.user.streak;
                    if(s % 7 === 0) UI.toast("üèÜ " + s + " G√ºnl√ºk Zincir!", "gold");
                }
            }
            this.data.today = { date: now, time: 0, mat: 0, tr: 0, par: 0, frozen: false, completed: false };
            
            var name = State.data.user.name || "Kral";
            Notify.send("‚òÄÔ∏è G√ºnaydƒ±n " + name, "Bug√ºn paragraf √ß√∂zd√ºn m√º?");
        }
        this.save();
    },

    updateMission: function(type, val) {
        this.data.weekly.missions.forEach(function(m){
            if(m.type === type && !m.claimed) {
                m.current += val;
                if(m.current > m.target) m.current = m.target;
            }
        });
    }
};

/* --- üéØ GOALS MANAGER (NEW) --- */
var Goals = {
    add: function() {
        var name = document.getElementById('new-goal-name').value;
        var net = parseFloat(document.getElementById('new-goal-net').value);
        
        if(!name || isNaN(net) || net <= 0) return UI.toast("Ge√ßerli bir hedef girin", "err");
        if(State.data.user.goals.length >= 7) return UI.toast("Max 7 hedef sƒ±nƒ±rƒ±!", "err");
        
        State.data.user.goals.push({ name: name, net: net });
        // Sort by Net Desc (Highest First)
        State.data.user.goals.sort(function(a,b){ return b.net - a.net });
        
        State.save();
        document.getElementById('new-goal-name').value = '';
        document.getElementById('new-goal-net').value = '';
        UI.toast("Hedef Eklendi!");
    },
    
    remove: function(index) {
        if(confirm("Bu hedef silinsin mi?")) {
            State.data.user.goals.splice(index, 1);
            State.save();
        }
    },
    
    getColors: function(index) {
        var colors = ['var(--primary)', 'var(--secondary)', 'var(--tertiary)', 'var(--gold)', 'var(--purple)'];
        return colors[index % colors.length];
    }
};

/* --- ü§ñ AI & LOGIC --- */
var AI = {
    analyze: function() {
        var today = new Date();
        var exam = new Date(CONFIG.examDate);
        var daysLeft = Math.ceil(Math.abs(exam - today) / (1000 * 60 * 60 * 24));
        
        var rec = "Konu tekrarƒ± yap.";
        var inProg = State.data.topics.filter(function(t){ return t.status === 1; });
        var todo = State.data.topics.filter(function(t){ return t.status === 0; });
        
        var todayPar = State.data.today.par || 0;
        if(todayPar < CONFIG.dailyMin.par) {
            rec = "‚ö†Ô∏è √ñnce Paragraf √á√∂z!";
        } else if(inProg.length > 0) {
            rec = "Devam et: " + inProg[0].name;
        } else if(todo.length > 0) {
            rec = "Yeni Konu: " + todo[0].name;
        }

        var topicComp = Topics.getStats(); 
        var streakFactor = Math.min(State.data.user.streak * 2, 20); 
        var examFactor = 0;
        
        var currentNet = 0;
        if(State.data.exams.length > 0) {
            var lastNet = State.data.exams[State.data.exams.length-1].total;
            currentNet = lastNet;
            // Base Readiness on Primary Goal (if exists), else 70
            var target = State.data.user.goals.length > 0 ? State.data.user.goals[0].net : 70;
            examFactor = Math.min((lastNet / target) * 40, 40); 
        }
        var readiness = Math.floor((topicComp * 0.4) + streakFactor + examFactor);

        var yesterday = new Date(); yesterday.setDate(today.getDate()-1);
        var yKey = yesterday.toISOString().split('T')[0];
        var yData = State.data.history[yKey];
        var mot = "Disiplin √∂zg√ºrl√ºkt√ºr.";
        if(yData && yData.time < State.data.today.time) mot = "üî• D√ºnden daha iyisin!";

        var name = State.data.user.name || "Kral";
        var dynamicMsg = "Merhaba " + name + ". ";

        // Dynamic Goal Feedback
        if (State.data.user.goals.length > 0) {
            var primary = State.data.user.goals[0];
            var gap = primary.net - currentNet;
            if(gap > 0) dynamicMsg += "Birincil hedefin " + primary.name + " i√ßin " + gap.toFixed(1) + " net daha gerekli. ";
            else dynamicMsg += "Birincil hedefine (" + primary.name + ") ula≈ütƒ±n! ";
        } else {
            dynamicMsg += "Hen√ºz hedef belirlemedin. ";
        }
        dynamicMsg += mot;

        return { days: daysLeft, rec: rec, msg: dynamicMsg, score: readiness, currentNet: currentNet };
    }
};

/* --- üìö TOPIC MANAGER --- */
var Topics = {
    filterView: 'mat',

    filter: function(subj) {
        this.filterView = subj;
        UI.renderTopics();
    },

    toggle: function(name) {
        var t = State.data.topics.find(function(i){ return i.name === name; });
        if(t) {
            t.status = (t.status + 1) % 3;
            if(t.status === 2) {
                State.data.user.xp += CONFIG.xp.topic;
                State.updateMission('topic', 1);
                UI.toast("üéâ Konu Bitti! +50 XP", "gold");
                Medals.check();
            }
            if(t.status === 1) State.updateMission('topic', 0.5); 
            State.save();
        }
    },

    addTopicQ: function(name) {
        var t = State.data.topics.find(function(i){ return i.name === name; });
        var input = document.getElementById('q-input-' + name.replace(/[^a-zA-Z0-9]/g, ''));
        var val = parseInt(input.value);
        if(!t || !val || val <= 0) return;

        t.q += val;
        App.addQ(t.subject, val); 
        input.value = "";
        State.save();
        UI.toast("+" + val + " Soru (Konu: " + t.name + ")");
    },

    getStats: function() {
        var total = State.data.topics.length;
        var done = State.data.topics.filter(function(t){ return t.status === 2; }).length;
        return Math.floor((done/total)*100);
    },

    getSubjectStats: function(subj) {
        var subT = State.data.topics.filter(function(t){ return t.subject === subj; });
        var done = subT.filter(function(t){ return t.status === 2; }).length;
        return {
            pct: Math.floor((done/subT.length)*100) || 0,
            rem: subT.length - done
        };
    }
};

/* --- üéñÔ∏è MEDALS --- */
var Medals = {
    check: function() {
        var unlocked = State.data.medals || [];
        var newlyUnlocked = false;
        
        MEDALS_DB.forEach(function(m){
            if(!unlocked.includes(m.id)) {
                if(m.check(State.data)) {
                    unlocked.push(m.id);
                    State.data.user.xp += 500; // XP Reward
                    UI.toast("üéñÔ∏è ROZET: " + m.title + " (+500 XP)", "gold");
                    newlyUnlocked = true;
                }
            }
        });
        
        if(newlyUnlocked) {
            State.data.medals = unlocked;
            State.save();
        }
    }
};

/* --- üë§ PROFILE --- */
var Profile = {
    save: function() {
        State.data.user.name = document.getElementById('prof-name').value;
        State.save();
        UI.toast("Profil Kaydedildi");
    },
    load: function() {
        if(document.getElementById('prof-name')) {
            document.getElementById('prof-name').value = State.data.user.name || '';
        }
        UI.renderGoalsManager();
    }
};

/* --- üïπÔ∏è MAIN CONTROLLER --- */
var App = {
    timer: null,
    startTime: null,

    toggleFocus: function() {
        if(this.timer) this.stopFocus();
        else this.startFocus();
    },

    startFocus: function() {
        this.startTime = Date.now();
        document.getElementById('focus-ui').classList.add('active');
        document.getElementById('btn-timer').innerText = "Bƒ∞Tƒ∞R (KAYDET)";
        document.getElementById('btn-timer').classList.add('stop');
        var self = this;
        this.timer = setInterval(function(){
            var diff = Math.floor((Date.now() - self.startTime)/1000);
            document.getElementById('timer-disp').innerText = self.fmtTime(diff);
        }, 1000);
    },

    stopFocus: function() {
        var dur = Math.floor((Date.now() - this.startTime)/1000);
        if(dur > 60) {
            State.data.today.time += dur;
            State.data.user.xp += Math.floor(dur/60) * CONFIG.xp.min;
            State.data.stats.totalTime += dur;
            State.updateMission('time', dur);
            this.checkGoal();
            UI.toast("‚úÖ Kaydedildi: " + Math.floor(dur/60) + "dk");
            Medals.check();
        } else {
            UI.toast("‚ö†Ô∏è S√ºre √ßok kƒ±sa", "err");
        }
        clearInterval(this.timer);
        this.timer = null;
        document.getElementById('focus-ui').classList.remove('active');
        document.getElementById('btn-timer').innerText = "BA≈ûLAT";
        document.getElementById('btn-timer').classList.remove('stop');
        document.getElementById('timer-disp').innerText = "00:00";
        State.save();
    },

    addQ: function(type, valIn) {
        var val = valIn;
        if(!val) {
            var el = document.getElementById('inp-' + type);
            if (el) {
                val = parseInt(el.value);
                el.value = "";
            }
        }
        
        if(!val || val <= 0) return;
        
        if(type === 'mat') State.data.today.mat += val;
        else if(type === 'tr') State.data.today.tr += val;
        else if(type === 'par') State.data.today.par += val;
        
        State.data.user.xp += val * CONFIG.xp.q;
        State.data.stats.totalQ += val;
        State.updateMission('q', val);
        
        this.checkGoal();
        State.save();
        if(!valIn) UI.toast("+" + val + " Soru"); 
        Medals.check();
    },

    addExam: function() {
        var m = parseFloat(document.getElementById('exam-mat').value);
        var t = parseFloat(document.getElementById('exam-tr').value);
        if(isNaN(m)) return;
        State.data.exams.push({date: new Date().toISOString().split('T')[0], mat: m, tr: t, total: m+t});
        State.data.user.xp += 100;
        State.save();
        UI.toast("üìù Deneme Eklendi!");
        Medals.check();
    },

    addBook: function() {
        var n = document.getElementById('book-name').value;
        var p = parseInt(document.getElementById('book-pages').value);
        if(!n || !p) return;
        State.data.books.unshift({ title: n, pages: p, date: new Date().toLocaleDateString() });
        State.data.user.xp += p * CONFIG.xp.page;
        State.save();
        document.getElementById('book-name').value = "";
        document.getElementById('book-pages').value = "";
        UI.toast("üìñ Okuma Eklendi! +" + (p*CONFIG.xp.page) + " XP");
        Medals.check();
    },

    checkGoal: function() {
        var t = State.data.today;
        var r = CONFIG.dailyMin;
        if(!t.completed && t.time >= r.time && t.mat >= r.mat && t.tr >= r.tr && t.par >= r.par) {
            t.completed = true;
            State.data.user.streak++;
            State.data.user.diamonds += 50;
            UI.toast("üî• G√úNL√úK HEDEF TAMAM!", "gold");
            var name = State.data.user.name || "Kral";
            Notify.send("Tebrikler " + name + "!", "Zincir devam ediyor.");
        }
    },

    tryFreeze: function() {
        if(State.data.today.completed) return UI.toast("Bug√ºn zaten bitti");
        if(State.data.inventory.freeze > 0) {
            if(confirm("Kalkan kullan?")) {
                State.data.inventory.freeze--;
                State.data.today.frozen = true;
                State.save();
                UI.toast("‚ùÑÔ∏è Donduruldu");
            }
        } else UI.toast("Kalkan yok", "err");
    },

    fmtTime: function(s) {
        var m = Math.floor(s/60);
        var sec = s%60;
        return (m<10?"0"+m:m) + ":" + (sec<10?"0"+sec:sec);
    }
};

/* --- ‚òÅÔ∏è DATA MANAGER --- */
var DataMgr = {
    backup: function() {
        var dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(State.data));
        var node = document.createElement('a');
        node.setAttribute("href", dataStr);
        node.setAttribute("download", "dgs_backup.json");
        document.body.appendChild(node); node.click(); node.remove();
    },
    import: function(input) {
        var file = input.files[0];
        if(!file) return;
        var reader = new FileReader();
        reader.onload = function(e) {
            try {
                var json = JSON.parse(e.target.result);
                if(json.user) { State.data = json; State.save(); UI.toast("‚úÖ Veri Y√ºklendi!"); setTimeout(function(){location.reload()},1000); }
            } catch(err) { UI.toast("Hatalƒ± Dosya", "err"); }
        };
        reader.readAsText(file);
    },
    copySyncCode: function() {
        var str = JSON.stringify(State.data);
        var code = window.btoa(unescape(encodeURIComponent(str)));
        navigator.clipboard.writeText(code).then(function() {
            UI.toast("üìã Kod Kopyalandƒ±!");
        });
    },
    loadSyncCode: function() {
        var code = document.getElementById('sync-input').value;
        if(!code) return;
        try {
            var str = decodeURIComponent(escape(window.atob(code)));
            var json = JSON.parse(str);
            if(json.user) {
                State.data = json;
                State.save();
                UI.toast("‚úÖ Senkronizasyon Ba≈üarƒ±lƒ±!");
                setTimeout(function(){location.reload()}, 1000);
            }
        } catch(e) { UI.toast("Ge√ßersiz Kod", "err"); }
    },
    reset: function() {
        if(confirm("HER ≈ûEY Sƒ∞Lƒ∞NECEK?")) {
            localStorage.removeItem(CONFIG.storageKey);
            location.reload();
        }
    }
};

/* --- üé® UI RENDERER --- */
var UI = {
    render: function() {
        var d = State.data;
        var t = d.today;

        // HUD
        document.getElementById('hud-streak').innerText = d.user.streak;
        document.getElementById('hud-diamonds').innerText = d.user.diamonds;
        document.getElementById('hud-xp').innerText = d.user.xp;
        document.getElementById('inv-display').innerText = "üõ°Ô∏è " + d.inventory.freeze + " | ‚ö° " + d.inventory.boost;

        // Progress Bars
        this.setBar('time', t.time, CONFIG.dailyMin.time, 's');
        this.setBar('mat', t.mat, CONFIG.dailyMin.mat, '');
        this.setBar('tr', t.tr, CONFIG.dailyMin.tr, '');
        this.setBar('par', t.par, CONFIG.dailyMin.par, '');

        // AI & Goals
        var ai = AI.analyze();
        document.getElementById('ai-message').innerText = ai.msg;
        document.getElementById('rec-text').innerText = ai.rec;
        document.getElementById('ai-score').innerText = ai.score + "%";
        document.getElementById('ai-days').innerText = ai.days;

        // Topic Stats
        var mStat = Topics.getSubjectStats('mat');
        var tStat = Topics.getSubjectStats('tr');
        var pStat = Topics.getSubjectStats('par');
        
        document.getElementById('stat-mat-pct').innerText = mStat.pct + "%";
        document.getElementById('stat-tr-pct').innerText = tStat.pct + "%";
        document.getElementById('stat-par-pct').innerText = pStat.pct + "%";
        
        // 5Ô∏è‚É£ DASHBOARD DYNAMIC GOALS
        this.renderDashboardGoals(ai.currentNet);
        
        this.renderMissions();
        this.renderTopics();
        this.drawGraph();
        this.drawCalendar();
        this.renderBooks();
        this.renderMedals();
        
        // Only load profile if active to save redraws, but renderGoalsManager needs to run if profile open
        if (!document.getElementById('view-profile').classList.contains('hidden')) {
            Profile.load();
        }
    },

    renderDashboardGoals: function(currentNet) {
        var container = document.getElementById('dynamic-goals-container');
        if (!container) return; // Safety
        
        var goals = State.data.user.goals || [];
        
        if (goals.length === 0) {
            container.innerHTML = '<div style="text-align:center; padding:10px; font-size:0.8rem; color:#666;">Hen√ºz hedef eklenmedi.<br>Profil sekmesinden ekle.</div>';
            return;
        }

        var html = '';
        goals.forEach(function(g, idx){
            var color = Goals.getColors(idx);
            var gap = g.net - currentNet;
            var pct = Math.min(100, (currentNet / g.net) * 100);
            var statusText = gap > 0 ? gap.toFixed(1) + " net kaldƒ±" : "Hedef Yakalandƒ±! üéâ";
            
            html += '<div style="margin-bottom:8px;">' +
                    '<div style="display:flex; justify-content:space-between; font-size:0.7rem; margin-bottom:2px;">' +
                        '<span style="color:' + color + ';">' + g.name + '</span>' +
                        '<span style="color:#666;">' + statusText + '</span>' +
                    '</div>' +
                    '<div class="goal-bar"><div class="goal-fill" style="width:' + pct + '%; background:' + color + '"></div></div>' +
                    '</div>';
        });
        
        // Update total net display at top of card
        document.getElementById('ai-score').innerText = currentNet + " Net";
        container.innerHTML = html;
    },

    renderGoalsManager: function() {
        var list = document.getElementById('goals-management-list');
        if(!list) return;
        var goals = State.data.user.goals || [];
        var html = '';
        goals.forEach(function(g, i){
            html += '<div class="goal-list-item">' +
                '<span class="goal-list-info">' + (i+1) + '. ' + g.name + '</span>' +
                '<div>' +
                    '<span class="goal-list-net">' + g.net + ' Net</span>' +
                    '<button class="goal-del-btn" onclick="Goals.remove(' + i + ')">√ó</button>' +
                '</div></div>';
        });
        list.innerHTML = html;
    },

    renderMissions: function() {
        var list = document.getElementById('missions-list');
        list.innerHTML = "";
        State.data.weekly.missions.forEach(function(m){
            var pct = Math.min(100, (m.current / m.target) * 100);
            var displayCurr = m.type === 'time' ? Math.floor(m.current/60) : Math.floor(m.current);
            var displayTarg = m.type === 'time' ? Math.floor(m.target/60) + 'dk' : m.target;
            
            var html = '<div class="mission-item">' +
                '<div class="mission-head"><span>' + m.text + '</span><span>' + displayCurr + '/' + displayTarg + '</span></div>' +
                '<div class="mission-bar"><div class="mission-fill" style="width:' + pct + '%"></div></div>' +
                '</div>';
            list.innerHTML += html;
        });
    },

    renderBooks: function() {
        var list = document.getElementById('book-list');
        list.innerHTML = "";
        State.data.books.slice(0,5).forEach(function(b){
            list.innerHTML += "<div>üìñ " + b.title + " (" + b.pages + " syf)</div>";
        });
    },

    renderTopics: function() {
        var list = document.getElementById('topics-list');
        list.innerHTML = "";
        var filtered = State.data.topics.filter(function(t){ return t.subject === Topics.filterView; });
        filtered.forEach(function(t) {
            var statusClass = t.status === 2 ? 'done' : (t.status === 1 ? 'in-progress' : '');
            var icon = t.status === 2 ? '‚úì' : (t.status === 1 ? '‚ñ∫' : '');
            var inputId = 'q-input-' + t.name.replace(/[^a-zA-Z0-9]/g, ''); 
            
            var html = '<div class="topic-item ' + statusClass + '">' +
                '<div class="topic-header" onclick="Topics.toggle(\'' + t.name + '\')">' +
                    '<div><div class="topic-name">' + t.name + '</div><div class="topic-stats">√á√∂z√ºlen: ' + t.q + '</div></div>' +
                    '<div class="topic-check-btn">' + icon + '</div>' +
                '</div>' +
                '<div class="topic-controls">' +
                    '<input type="number" id="' + inputId + '" class="topic-input" placeholder="+Soru">' +
                    '<div class="topic-add-btn" onclick="Topics.addTopicQ(\'' + t.name + '\')">+</div>' +
                '</div>' +
                '</div>';
            list.innerHTML += html;
        });
    },

    renderMedals: function() {
        var list = document.getElementById('medal-container');
        list.innerHTML = "";
        var unlocked = State.data.medals || [];
        MEDALS_DB.forEach(function(m){
            var isUnlocked = unlocked.includes(m.id);
            var cls = isUnlocked ? 'unlocked' : '';
            var html = '<div class="medal-card ' + cls + '"><span class="medal-icon">' + m.icon + '</span><div class="medal-title">' + m.title + '</div><div class="medal-desc">' + m.req + '</div></div>';
            list.innerHTML += html;
        });
    },

    setBar: function(id, val, max, type) {
        var el = document.getElementById('fill-' + id);
        var txt = document.getElementById('prog-txt-' + id);
        var pct = Math.min(100, (val/max)*100);
        el.style.width = pct + "%";
        txt.innerText = (type==='s' ? Math.floor(val/60) : val) + "/" + (type==='s' ? max/60 : max);
    },

    drawGraph: function() {
        var con = document.getElementById('net-graph');
        var exams = State.data.exams;
        if(exams.length < 2) return con.innerHTML = "<div style='text-align:center; padding-top:40px; color:#444; font-size:0.7rem;'>Grafik i√ßin 2 deneme gir.</div>";

        var w = con.clientWidth;
        var h = con.clientHeight;
        
        // Dynamic Graph Scaling based on Primary Goal
        var max = 70; 
        if (State.data.user.goals.length > 0) max = State.data.user.goals[0].net;
        
        exams.forEach(function(e){ if(e.total > max) max = e.total; });
        var points = "";
        
        exams.forEach(function(e, i) {
            var x = i * (w / (exams.length - 1));
            var y = h - ((e.total / max) * h);
            points += x + "," + y + " ";
        });
        
        con.innerHTML = '<svg><polyline points="' + points + '" stroke="var(--primary)" fill="none"/><polyline points="0,' + (h - (State.data.user.targetNet/max)*h) + ' ' + w + ',' + (h - (State.data.user.targetNet/max)*h) + '" stroke="var(--purple)" stroke-dasharray="4" opacity="0.5"/></svg>';
    },

    drawCalendar: function() {
        var el = document.getElementById('cal-render');
        el.innerHTML = "";
        var hist = State.data.history;
        var todayKey = State.data.today.date;
        var d = new Date();
        for(var i=13; i>=0; i--) {
            var temp = new Date();
            temp.setDate(d.getDate() - i);
            var k = temp.toISOString().split('T')[0];
            var hItem = hist[k];
            var status = '';
            if(k === todayKey) {
                status = State.data.today.completed ? 'hit' : 'today';
            } else if(hItem) {
                status = hItem.status;
            }
            var clickData = hItem ? JSON.stringify(hItem).replace(/"/g, '&quot;') : '';
            var clickAction = hItem ? 'onclick="UI.showDayDetail(this)" data-info="' + clickData + '"' : '';
            el.innerHTML += '<div class="cal-cell ' + status + '" ' + clickAction + '>' + temp.getDate() + '</div>';
        }
    },

    showDayDetail: function(el) {
        var data = el.getAttribute('data-info');
        if(!data) return;
        try {
            var obj = JSON.parse(data);
            UI.toast("‚è±Ô∏è " + Math.floor(obj.time/60) + "dk | ‚úèÔ∏è " + obj.q + " Soru");
        } catch(e){}
    },

    closeOnboarding: function() {
        document.getElementById('onboarding').classList.add('hidden');
    },

    toast: function(msg, type) {
        var t = document.getElementById('toast');
        var i = document.getElementById('t-icon');
        document.getElementById('t-msg').innerText = msg;
        i.innerText = type === 'err' ? '‚ö†Ô∏è' : (type === 'gold' ? 'üíé' : '‚úÖ');
        t.style.borderColor = type === 'err' ? 'var(--danger)' : '#444';
        t.classList.add('visible');
        setTimeout(function(){ t.classList.remove('visible'); }, 3000);
    }
};

/* --- üîî NOTIFICATIONS --- */
var Notify = {
    req: function() {
        if (!("Notification" in window)) return UI.toast("Tarayƒ±cƒ± desteklemiyor", "err");
        Notification.requestPermission().then(function(p) {
            if(p === "granted") UI.toast("Bildirimler A√ßƒ±k");
        });
    },
    send: function(title, body) {
        if ("Notification" in window && Notification.permission === "granted") {
            var name = State.data.user.name ? State.data.user.name + ", " : "";
            new Notification(title, { body: name + body });
        }
    }
};

/* --- üß≠ NAV --- */
var Nav = {
    go: function(id) {
        document.querySelectorAll('.view').forEach(function(e){ e.classList.add('hidden'); });
        document.getElementById('view-' + id).classList.remove('hidden');
        document.querySelectorAll('.nav-item').forEach(function(e){ e.classList.remove('active'); });
        
        var idx = id==='dash'?0 : id==='topics'?1 : id==='stats'?2 : id==='medals'?3 : 4;
        document.querySelectorAll('.nav-item')[idx].classList.add('active');
        
        if(id === 'topics') UI.renderTopics();
        if(id === 'stats') { UI.drawGraph(); UI.renderBooks(); }
        if(id === 'medals') UI.renderMedals();
        if(id === 'profile') Profile.load(); // Load Profile & Goals
    }
};

// PWA: Dynamically Inject Manifest
var link = document.createElement('link');
link.rel = 'manifest';
var manifest = {
    name: "DGS Life OS", short_name: "DGS OS", start_url: ".", display: "standalone",
    background_color: "#000000", theme_color: "#000000",
    icons: [{ src: "https://cdn-icons-png.flaticon.com/512/2997/2997235.png", sizes: "192x192", type: "image/png" }]
};
link.href = 'data:application/json;base64,' + window.btoa(unescape(encodeURIComponent(JSON.stringify(manifest))));
document.head.appendChild(link);

window.onload = function() { State.init(); UI.render(); };
</script>
</body>
</html>
